import{r as b,j as e,u as p,ag as U,ae as z,ay as H,t as Y,h as q,ak as G,az as W,d as J,al as K,G as Q,ai as X,aj as Z}from"./ui-N7HjBcuT.js";import{u as $,B as h,C as o,a as x,I as ee,S as v,b as y,c as w,d as C,e as d,f as se,g as ae,T as te,h as le,i as f,j as n,k as re,l as c,m as ce,n as u}from"./index-D9rRU7mG.js";import"./vendor-D3F3s8fL.js";import"./supabase-BXl3LOEh.js";function xe(){const{state:T,dispatch:i}=$(),{members:l,filters:S,loading:E}=T,t=S.members,g=b.useMemo(()=>l.filter(s=>{const a=t.searchTerm===""||s.name.toLowerCase().includes(t.searchTerm.toLowerCase())||s.phone.includes(t.searchTerm)||s.email.toLowerCase().includes(t.searchTerm.toLowerCase()),m=t.status==="all"||s.status===t.status;return a&&m}).sort((s,a)=>{switch(t.sortBy){case"name":return s.name.localeCompare(a.name);case"date":return new Date(a.joinDate).getTime()-new Date(s.joinDate).getTime();case"visits":return a.totalVisits-s.totalVisits;case"amount":return a.totalAmount-s.totalAmount;default:return s.name.localeCompare(a.name)}}),[l,t]),j=b.useMemo(()=>{const s=l.length,a=l.filter(r=>r.status==="활성").length,m=l.filter(r=>r.status==="비활성").length,_=l.filter(r=>r.priority==="high").length,O=l.reduce((r,N)=>r+N.totalAmount,0),R=s>0?l.reduce((r,N)=>r+N.totalVisits,0)/s:0;return{total:s,active:a,inactive:m,highPriority:_,totalAmount:O,avgVisits:Math.round(R*10)/10}},[l]),A=s=>s==="활성"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",D=s=>({high:"bg-red-100 text-red-800",normal:"bg-gray-100 text-gray-800",low:"bg-blue-100 text-blue-800"})[s]||"bg-gray-100 text-gray-800",M=s=>({high:"높음",normal:"보통",low:"낮음"})[s]||"보통",P=s=>{i({type:"UPDATE_FILTERS",payload:{section:"members",filters:{searchTerm:s}}})},V=s=>{i({type:"UPDATE_FILTERS",payload:{section:"members",filters:{status:s}}})},L=s=>{i({type:"UPDATE_FILTERS",payload:{section:"members",filters:{sortBy:s}}})},F=()=>{i({type:"OPEN_MODAL",payload:{type:"member-add",data:null}})},B=s=>{i({type:"OPEN_MODAL",payload:{type:"member-edit",data:s}})},I=s=>{i({type:"OPEN_MODAL",payload:{type:"member-view",data:s}})},k=s=>{window.confirm("정말 삭제하시겠습니까?")&&i({type:"DELETE_MEMBER",payload:s})};return E?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-emerald-100 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(p,{className:"w-6 h-6 mr-3 text-emerald-600"}),"회원 관리"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"환자 정보를 체계적으로 관리하세요"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(h,{variant:"outline",className:"border-emerald-200 hover:bg-emerald-50",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"엑셀 내보내기"]}),e.jsxs(h,{onClick:F,className:"bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"회원 추가"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"총 회원 수"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-800",children:[j.total,"명"]})]}),e.jsx(p,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"활성 회원"}),e.jsxs("p",{className:"text-2xl font-bold text-green-800",children:[j.active,"명"]})]}),e.jsx(H,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-700 font-medium",children:"VIP 회원"}),e.jsxs("p",{className:"text-2xl font-bold text-red-800",children:[j.highPriority,"명"]})]}),e.jsx(Y,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700 font-medium",children:"평균 방문"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-800",children:[j.avgVisits,"회"]})]}),e.jsx(q,{className:"w-8 h-8 text-purple-600"})]})})})]}),e.jsx(o,{className:"shadow-lg border-0 bg-white",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"w-4 h-4 absolute left-3 top-3.5 text-gray-400"}),e.jsx(ee,{placeholder:"이름, 전화번호, 이메일로 검색...",value:t.searchTerm,onChange:s=>P(s.target.value),className:"pl-10 border-emerald-200 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs(v,{value:t.status,onValueChange:V,children:[e.jsx(y,{className:"w-full md:w-48 border-emerald-200",children:e.jsx(w,{placeholder:"상태별 필터"})}),e.jsxs(C,{children:[e.jsx(d,{value:"all",children:"전체 상태"}),e.jsx(d,{value:"활성",children:"활성 회원"}),e.jsx(d,{value:"비활성",children:"비활성 회원"})]})]}),e.jsxs(v,{value:t.sortBy,onValueChange:L,children:[e.jsx(y,{className:"w-full md:w-48 border-emerald-200",children:e.jsx(w,{placeholder:"정렬 기준"})}),e.jsxs(C,{children:[e.jsx(d,{value:"name",children:"이름순"}),e.jsx(d,{value:"date",children:"가입일순"}),e.jsx(d,{value:"visits",children:"방문횟수순"}),e.jsx(d,{value:"amount",children:"치료비순"})]})]})]})})}),e.jsxs(o,{className:"shadow-lg border-0 bg-white",children:[e.jsx(se,{className:"bg-gradient-to-r from-emerald-50 to-green-50 border-b border-emerald-100",children:e.jsx(ae,{className:"text-emerald-800 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"w-5 h-5 mr-2"}),"회원 목록 (",g.length,"명)"]})})}),e.jsx(x,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(le,{className:"bg-emerald-50",children:e.jsxs(f,{children:[e.jsx(n,{className:"font-semibold text-emerald-800",children:"회원 정보"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"연락처"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"가입정보"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"방문현황"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"치료내역"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"상태"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"우선도"}),e.jsx(n,{className:"font-semibold text-emerald-800",children:"관리"})]})}),e.jsx(re,{children:g.length===0?e.jsx(f,{children:e.jsxs(c,{colSpan:8,className:"text-center py-8 text-gray-500",children:[e.jsx(W,{className:"w-8 h-8 mx-auto mb-2"}),"검색 조건에 맞는 회원이 없습니다."]})}):g.map(s=>e.jsxs(f,{className:"hover:bg-emerald-50/30",children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-emerald-100",children:s.avatar?e.jsx(ce,{src:s.avatar,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-emerald-600 font-bold",children:s.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.gender," • ",new Date().getFullYear()-new Date(s.birthDate).getFullYear(),"세"]})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(J,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[e.jsx(K,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"truncate",children:s.email})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.joinDate}),e.jsx("p",{className:"text-xs text-gray-600",children:"가입일"})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-semibold",children:[s.totalVisits,"회"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["최근: ",s.lastVisit]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.treatments.slice(0,2).map((a,m)=>e.jsx(u,{variant:"outline",className:"text-xs",children:a},m)),s.treatments.length>2&&e.jsxs(u,{variant:"outline",className:"text-xs",children:["+",s.treatments.length-2]})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["총액: ",s.totalAmount.toLocaleString(),"원"]})]})}),e.jsx(c,{children:e.jsx(u,{className:A(s.status),variant:"outline",children:s.status})}),e.jsx(c,{children:e.jsx(u,{className:D(s.priority),variant:"outline",children:M(s.priority)})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(h,{size:"sm",variant:"outline",className:"border-gray-300",onClick:()=>I(s),children:e.jsx(Q,{className:"w-3 h-3"})}),e.jsx(h,{size:"sm",variant:"outline",className:"border-emerald-300 text-emerald-600 hover:bg-emerald-50",onClick:()=>B(s),children:e.jsx(X,{className:"w-3 h-3"})}),e.jsx(h,{size:"sm",variant:"outline",className:"border-red-300 text-red-600 hover:bg-red-50",onClick:()=>k(s.id),children:e.jsx(Z,{className:"w-3 h-3"})})]})})]},s.id))})]})})})]})]})}export{xe as default};
